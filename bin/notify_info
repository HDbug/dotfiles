#!/bin/bash

clock_symbol=$CLOCK_ICON
clock=$(date +'%H:%M') 

date_symbol=$CALENDAR_ICON
date=$(date +'%d.%m.') 

kmap_symbol=$KEYBOARD_ICON
kmap=$(caps $(setxkbmap -print | awk -F'+' '/xkb_symbols/ {print $2}'))
[[ $kmap == *_* ]] && kmap=$(echo $kmap | awk -F "_" '{print $1}')
kmap_command="toggle_kmap no_notify && notify_info"

vol_symbol=$VOL_ICON
vol=$(query_vol)
vol_command="toggle_mute no_notify && notify_info"

if [[ $(query_mute) == true ]]; then
	vol_symbol=$MUTE_ICON
fi

battery=$(acpi | cut -d " " -f 4  | sed 's/[^0-9]//g')
battery_symbol=$BATTERY_ICON
battery_icon_no=$(awk  'BEGIN { rounded = sprintf("%.0f", '$battery'/25); print rounded }')
battery_icon_name="BATTERY_"$battery_icon_no"_ICON"
battery_symbol=${!battery_icon_name}
[[ $(acpi | cut -d " " -f 3) != *Discharging* ]] && battery_symbol="$CHORD_PLUGGED $battery_symbol"

sep=" "
gap=$sep

widgets=("wifi" "battery" "kmap" "vol" "date" "clock")

symbols=""
datas=""

notify=""
for w in ${widgets[@]}; do
	data=${!w}
	declare symbol=$w"_symbol"
	symbol=${!symbol}
	command_prefix=""
	command_suffix=""
	declare command=$w"_command"
	command=${!command}
	if [[ -n $command ]]; then
		command_prefix="%{A:"$command":}"
		command_suffix="%{A}"
	fi
	notify=$notify$command_prefix$symbol$sep$data$command_suffix$gap
done
notify=${notify%%$gap}

notify-no-icon "$notify"
